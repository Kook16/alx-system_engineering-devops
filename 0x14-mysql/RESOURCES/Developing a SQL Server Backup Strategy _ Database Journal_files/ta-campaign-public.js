(()=>{function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function t(t){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?e(Object(a),!0).forEach((function(e){i(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}jQuery(document).ready((function(e){!function(){for(var e=0,t=a(document.getElementsByClassName("ta-campaign-widget"));e<t.length;e++){var n=t[e];new o(n)}}()}));var o=function(){function e(t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),i(this,"element",null),i(this,"config",null),i(this,"eventListeners",[]),this.element=t,this.readConfig()?this.bubbleElement()?this.initializeEventListeners()?this.loaded()?void 0:(console.log("Failed to initialize campaign widget plugin"),this.failed()):(console.log("Failed to initialize campaign event listeners"),this.failed()):(console.log("Failed to bubble element"),this.failed()):(console.log("Failed to initialize campaign config"),this.failed())}var r,o,c;return r=e,o=[{key:"readConfig",value:function(){var e=this.element.dataset.campaignFields;return e?(this.config=JSON.parse(e),this.config?this:null):this}},{key:"bubbleElement",value:function(){if("popup"==this.config.campaign_type){var e=document.getElementById("ta-campaign-widget-".concat(this.config.identifier,"-popup-wrapper"));document.body.appendChild(e)}return!0}},{key:"initializeEventListeners",value:function(){var e=this,n=this.element.getElementsByClassName("ta-campaign-widget__form")[0];if(!n)return null;if(this.eventListeners.push(n.addEventListener("submit",(function(n){return n.preventDefault(),e.setLoadingState(),e.clearValidationErrors(),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(l(),{method:"POST",body:new URLSearchParams(t({action:e},n))})}("taurus_get_subscribe_url",t({campaign_id:e.config.campaign_id},e.fields)).then((function(e){return e.json()})).then((function(t){var n=t.data;t.success?window.location.href=n.url:e.handleValidationErrors(n)})).catch((function(t){console.log(t);var n=document.createElement("p");n.classList.add("ta-campaign-widget__validation-error"),n.innerText="Unable to subscribe you to this newsletter, please try again later.",e.element.appendChild(n)})).finally((function(){e.clearLoadingState()}))}))),"popup"==this.config.campaign_type){var i=document.getElementById("ta-campaign-widget-".concat(this.config.identifier,"-popup-wrapper"));i&&(i.addEventListener("click",(function(){return e.closePopup()})),this.element.addEventListener("click",(function(e){return e.stopPropagation()})),this.element.getElementsByClassName("ta-campaign-widget__exit")[0].addEventListener("click",(function(){return e.closePopup()})),"button"==this.config.popup_type||"link"==this.config.popup_type?document.getElementById("ta-campaign-widget-".concat(this.config.identifier,"-display-popup-button")).addEventListener("click",(function(t){t.preventDefault(),e.openPopup()})):"exit_intent"==this.config.popup_type&&window.ouibounce(null,{callback:function(){e.openPopup()}}))}return this}},{key:"initializeColors",value:function(){var e=this;return Object.keys(this.config.appearance.colors).forEach((function(t){var n=e.config.appearance.colors[t];e.element.style.setProperty("--ta-campaign-plugin-".concat(t),n)})),this}},{key:"loaded",value:function(){return this}},{key:"failed",value:function(){this.element.remove()}},{key:"handleValidationErrors",value:function(e){var t=this;Object.keys(e).forEach((function(n){var i=t.element.querySelector("[data-field='".concat(n,"']"));i.querySelector("input").classList.add("ta-campaign-widget__invalid-border");var a=document.createElement("p");a.classList.add("ta-campaign-widget__validation-error"),a.innerText=e[n],i.appendChild(a)}))}},{key:"setLoadingState",value:function(){var e=this.element.querySelector(".ta-campaign-widget__button");e&&(e.disabled=!0,e.classList.add("ta-campaign-widget__button--toggle"),e.innerHTML='\n        <svg class="mr-2" width="15" height="15" stroke="var(--ta-campaign-plugin-button-toggle-text)" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g><circle cx="12" cy="12" r="9.5" fill="none" stroke-width="3" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" calcMode="spline" values="0 150;42 150;42 150;42 150" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite"/><animate attributeName="stroke-dashoffset" dur="1.5s" calcMode="spline" values="0;-16;-59;-59" keyTimes="0;0.475;0.95;1" keySplines="0.42,0,0.58,1;0.42,0,0.58,1;0.42,0,0.58,1" repeatCount="indefinite"/></circle><animateTransform attributeName="transform" type="rotate" dur="2s" values="0 12 12;360 12 12" repeatCount="indefinite"/></g></svg>\n        Processing\n        ')}},{key:"clearLoadingState",value:function(){var e=this.element.querySelector(".ta-campaign-widget__button");e&&(e.disabled=!1,e.classList.remove("ta-campaign-widget__button--toggle"),e.innerText=this.config.language.subscribe_button)}},{key:"clearValidationErrors",value:function(){a(this.element.querySelectorAll(".ta-campaign-widget__invalid-border")).forEach((function(e){return e.classList.remove("ta-campaign-widget__invalid-border")})),a(this.element.querySelectorAll(".ta-campaign-widget__validation-error")).forEach((function(e){return e.remove()}))}},{key:"openPopup",value:function(){console.timeLog("open");var e=document.getElementById("ta-campaign-widget-".concat(this.config.identifier,"-popup-wrapper"));e.style.display="flex",setTimeout((function(){e.style.opacity=1}),0)}},{key:"closePopup",value:function(){console.timeLog("close");var e=document.getElementById("ta-campaign-widget-".concat(this.config.identifier,"-popup-wrapper"));e.style.opacity=0,setTimeout((function(){e.style.display="none"}),300)}},{key:"fields",get:function(){var e={email:this.element.querySelector("[name='email']").value};return this.config.behavior.opt_in_enabled&&(e.opt_in=this.element.querySelector("[name='opt-in']").checked,e.opt_in_language=this.config.language.opt_in),e}}],o&&n(r.prototype,o),c&&n(r,c),Object.defineProperty(r,"prototype",{writable:!1}),e}();function l(){var e,t=window.origin+"/wp-admin/admin-ajax.php",n=document.querySelector("[data-ajax-url]");return n?(null===(e=n.dataset)||void 0===e?void 0:e.ajaxUrl)?n.dataset.ajaxUrl:(console.error("AJAX Url invalid, falling back to unsafe URL"),t):(console.error("Failed to get AJAX Url, falling back to unsafe URL"),t)}})();